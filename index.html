<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Exchange</title>
    <style>
        /* Общие стили */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        /* Фиксированный заголовок с кнопками */
        .header-wrap {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #ffffff;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            border-bottom: 1px solid #ccc;
        }

        /* Кнопки в заголовке */
        .header-button {
            font-size: 14px;
            padding: 5px 10px;
            border: 2px solid #00bfff;
            text-transform: lowercase;
            text-decoration: none;
            cursor: pointer;
            border-radius: 5px;
            background-color: transparent;
            transition: background-color 0.3s ease, color 0.3s ease;
            color: black;
        }
        .header-button:hover {
            background-color: #00bfff;
            color: white;
        }

        /* Подзаголовок */
        .sub-title {
            font-size: 20px;
            line-height: 18px;
            text-align: center;
            margin: 0;
            margin-top: 70px;
            margin-bottom: 20px;
        }

        /* Блок с рамкой */
        .content-block {
            width: 94%;
            max-width: 400px;
            margin: 0 auto;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background-color: #ffffff;
            box-sizing: border-box;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        /* Единый стиль для всех заголовков */
        .common-title {
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        /* Стиль для сепараторов */
        .separator {
            width: 100%;
            height: 1px;
            background-color: #00bfff;
            margin: 10px 0;
        }

        /* Блок Solana и Cayros */
        .sol-container, .cayros-container {
            display: flex;
            align-items: flex-start;
            margin-top: 20px;
        }

        /* Контейнер для изображения и кнопок */
        .image-button-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            height: 60px;
        }

        /* Изображения валют */
        .sol-image, .cayros-image {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 8px;
        }

        /* Контейнер для кнопок */
        .button-container {
            position: absolute;
            bottom: 0;
            left: 75px;
            display: flex;
            gap: 15px;
        }

        /* Стили кнопок */
        .action-button {
            display: inline-block;
            width: auto;
            font-size: 12px;
            padding: 5px 10px;
            border: 2px solid #00bfff;
            color: black;
            border-radius: 10px;
            text-decoration: none;
            text-align: center;
            background-color: transparent;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .action-button:hover {
            background-color: #00bfff;
            color: white;
        }

        /* Текст курса */
        .exchange-rate {
            font-size: 14px;
            margin: 0;
            margin-bottom: 10px;
        }

        /* Блок с изображением и текстом */
        .wallet-info {
            margin-top: 20px;
            display: flex;
            align-items: center;
        }
        .wallet-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
        }
        .wallet-text {
            font-size: 14px;
            margin-left: 15px;
        }
        .wallet-link {
            color: #00bfff;
            text-decoration: none;
        }
        .wallet-link:hover {
            text-decoration: underline;
        }

        /* Изображение в нижней части экрана */
        .bottom-image {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            cursor: pointer;
            z-index: 999;
            outline: none;
        }

        /* Диалоговое окно */
        .dialog-box {
            display: none;
            position: absolute;
            bottom: calc(100% + 10px);
            left: 3%;
            background-color: white;
            border: 1px solid #00bfff;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            font-size: 14px;
            max-width: 300px;
            text-align: center;
        }

        /* Кнопки в диалоговом окне */
        .dialog-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }
        .dialog-button {
            padding: 5px 10px;
            font-size: 12px;
            border: 1px solid #00bfff;
            color: black;
            border-radius: 5px;
            cursor: pointer;
            background-color: transparent;
            transition: background-color 0.3s ease;
        }
        .dialog-button:hover {
            background-color: #00bfff;
            color: white;
        }

        /* Стиль для статуса загрузки */
        .loading-status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Фиксированный заголовок с кнопками -->
    <div class="header-wrap">
        <a href="rules.html" class="header-button">правила сервиса</a>
        <a href="support.html" class="header-button">поддержка</a>
        <a href="input.html" class="header-button">войти</a>
    </div>

    <!-- Подзаголовок -->
    <h1 class="sub-title">P2P Сервис обмена</h1>

    <!-- Основной контейнер с рамкой -->
    <div class="content-block">
        <!-- Заголовок "Купить ⇌ Продать" -->
        <div class="common-title">Купить ⇌ Продать</div>

        <!-- Блок Solana -->
        <div class="sol-container">
            <div class="image-button-container">
                <img src="https://github.com/CayrosBot/first/blob/main/sol_logo-min.jpg?raw=true" alt="Solana Logo" class="sol-image">
                <div class="button-container">
                    <a href="buy_solana.html" class="action-button">Купить</a>
                    <a href="sell_solana.html" class="action-button">Продать</a>
                </div>
            </div>
            <div class="exchange-rate">
                1 SOL = <span id="sol-price">...</span> RUB
                <div class="loading-status" id="sol-status"></div>
            </div>
        </div>

        <!-- Первый разделитель -->
        <div class="separator"></div>

        <!-- Блок Cayros -->
        <div class="cayros-container">
            <div class="image-button-container">
                <img src="https://github.com/CayrosBot/first/blob/main/cayros_logo-min.jpg?raw=true" alt="Cayros Logo" class="cayros-image">
                <div class="button-container">
                    <a href="buy_cayros.html" class="action-button">Купить</a>
                    <a href="sell_cayros.html" class="action-button">Продать</a>
                </div>
            </div>
            <div class="exchange-rate">
                1 CAYROS = <span id="cayros-price">...</span> RUB
                <div class="loading-status" id="cayros-status"></div>
            </div>
        </div>

        <!-- Второй разделитель -->
        <div class="separator"></div>

        <!-- Заголовок "Криптовалютный кошелек:" -->
        <div class="common-title">Криптовалютный кошелек:</div>

        <!-- Блок с изображением и текстом -->
        <div class="wallet-info">
            <img src="https://github.com/CayrosBot/first/blob/main/phantom-min.jpg?raw=true" alt="Phantom Wallet" class="wallet-image">
            <div class="wallet-text">
                Для хранения, перевода и получения криптовалют скачайте удобный кошелек 
                <a href="https://phantom.com/" target="_blank" class="wallet-link">Phantom wallet</a>.
            </div>
        </div>
    </div>

    <!-- Родительский контейнер для изображения и диалогового окна -->
    <div class="bottom-image-container">
        <img src="https://github.com/CayrosBot/first/blob/main/LogoBot.png?raw=true" alt="Bot Logo" class="bottom-image" id="bot-logo">
        <div class="dialog-box" id="dialog-box">
            <p>Рассказать тебе как начать торговать CAYROS?</p>
            <div class="dialog-buttons">
                <button class="dialog-button" id="dialog-yes">Да</button>
                <button class="dialog-button" id="dialog-no">Нет</button>
            </div>
        </div>
    </div>

    <script>
        // Конфигурация
        const POOL_ID = "6AvMUjDypofK8nw5Ez13qwFswJkLKomKTzX95ZWd682n";
        const SPREAD_PERCENT = 25; // 25% спред
        const CORS_PROXY = "https://corsproxy.io/?"; // Прокси для обхода CORS

        // Получаем курс SOL
        async function getSolPrice() {
            try {
                document.getElementById('sol-status').textContent = "Обновление...";
                const response = await fetch(`${CORS_PROXY}https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=rub`);
                const data = await response.json();
                const price = data.solana.rub.toFixed(2);
                document.getElementById('sol-price').textContent = price;
                document.getElementById('sol-status').textContent = "✓ Актуально";
                return price;
            } catch (error) {
                console.error("Ошибка при получении курса SOL:", error);
                document.getElementById('sol-price').textContent = "N/A";
                document.getElementById('sol-status').textContent = "✗ Ошибка";
                return null;
            }
        }

        // Получаем курс CAYROS
        async function getCayrosPrice() {
            try {
                document.getElementById('cayros-status').textContent = "Обновление...";
                
                // 1. Получаем цену CAYROS в USDT из Raydium
                const poolResponse = await fetch(`${CORS_PROXY}https://api-v3.raydium.io/pools/info/ids?ids=${POOL_ID}`);
                const poolData = await poolResponse.json();
                
                if (!poolData.success || !poolData.data[0]) {
                    throw new Error("Пул CAYROS не найден");
                }
                
                const cayrosUsdt = poolData.data[0].price;

                // 2. Получаем курс USDT/RUB
                const rubResponse = await fetch(`${CORS_PROXY}https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=rub`);
                const rubData = await rubResponse.json();
                const usdtRub = rubData.tether.rub;

                // 3. Рассчитываем курс
                const baseRateRub = (cayrosUsdt * usdtRub).toFixed(2);
                document.getElementById('cayros-price').textContent = baseRateRub;
                document.getElementById('cayros-status').textContent = "✓ Актуально";
                
                return baseRateRub;
            } catch (error) {
                console.error("Ошибка при получении курса CAYROS:", error);
                document.getElementById('cayros-price').textContent = "N/A";
                document.getElementById('cayros-status').textContent = "✗ Ошибка";
                return null;
            }
        }

        // Обновляем курсы при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            getSolPrice();
            getCayrosPrice();
            
            // Обновляем каждые 30 секунд
            setInterval(() => {
                getSolPrice();
                getCayrosPrice();
            }, 30000);
        });

        // Обработчики для диалогового окна
        document.getElementById('bot-logo').addEventListener('click', function() {
            const dialogBox = document.getElementById('dialog-box');
            dialogBox.style.display = 'block';
            if ('vibrate' in navigator) navigator.vibrate(100);
        });

        document.getElementById('dialog-no').addEventListener('click', function() {
            const dialogBox = document.getElementById('dialog-box');
            dialogBox.innerHTML = '<p>Я буду ждать</p>';
            setTimeout(() => dialogBox.style.display = 'none', 1000);
        });

        document.getElementById('dialog-yes').addEventListener('click', function() {
            window.location.href = 'how_to_sell.html';
        });

        document.addEventListener('click', function(event) {
            const dialogBox = document.getElementById('dialog-box');
            if (event.target.id !== 'bot-logo' && dialogBox.style.display === 'block') {
                dialogBox.style.display = 'none';
            }
        });
    </script>
</body>
</html>
